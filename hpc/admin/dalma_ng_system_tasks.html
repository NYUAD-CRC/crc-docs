

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>DalmaNG System Tasks &mdash; CRC Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/crc-wordmark-light.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">RCS Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rcs/index.html">Research Computing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rcs/kb/index.html">Knowledge Base</a></li>
</ul>
<p class="caption"><span class="caption-text">HPC Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">High Performance Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounts/index.html">Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/index.html">System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/index.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/index.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jobs/index.html">Jobs Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../research/index.html">Research Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/index.html">Help</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CRC Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>DalmaNG System Tasks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/hpc/admin/dalma_ng_system_tasks.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dalmang-system-tasks">
<h1>DalmaNG System Tasks<a class="headerlink" href="#dalmang-system-tasks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="kubernetes">
<h2>Kubernetes<a class="headerlink" href="#kubernetes" title="Permalink to this headline">¶</a></h2>
<dl>
<dt>8 mgmt servers (replacement for mgmt[1-3], home[1-2], apps[1-2]):</dt><dd><p>2 x 24 port 10G low latency switch
3 1U master - Ubuntu 20.04 servers:</p>
<blockquote>
<div><p>min 2 x 2.0GHz 8-core Intel Xeon Cascade/Cooper Lake CPU
128GB RAM
1Gb En for 2-port NYUAD external*
2x2 10Gb En for 2-port storage + 2-port (K8S+admin)
Battery-backed storage controller
min 800GB RAID1 mixed use SATA SSD</p>
</div></blockquote>
<dl class="simple">
<dt>3 1U worker - Ubuntu 20.04 servers:</dt><dd><p>min 2 x 2.4GHz 16-core Intel Xeon Cascade/Cooper Lake CPU
256GB RAM
1Gb En for 2-port NYUAD external*
2x2 10Gb En for 2-port storage + 2-port (K8S+admin)
1 EDR IB for NFS
Battery-backed storage controller
min 800GB RAID1 mixed use SATA SSD
min 6TB (system 1TB, home 3TB, apps ??) mixed use NVME (min DWPD 3)</p>
</dd>
<dt>2 worker - Ubuntu 18.04.5 servers:</dt><dd><p>1Gb En for NYUAD external
2x 1Gb En for K8S
2x 10Gb En for admin
1 EDR IB for lustre
RAID1 mixed use SATA SSD</p>
</dd>
</dl>
</dd>
<dt>Docker private registry HA (done)</dt><dd><p>Registry backup
need proper CA (done)
imagePullPolicy: Always
HPC Centos 8.2 base image (done)
HPC Ubuntu 18.04 base image (done)
HPC Ubuntu 20.04 base image (done)</p>
</dd>
</dl>
<p>Rancher</p>
<blockquote>
<div><p>v2.5
on Ubuntu 20.04 (done)
Feature overview (done)</p>
<p>Cluster template (done)</p>
<p>RCS HCI frontend (done)
RCS HCI HPC Lab (mini production) + project (development) space (pending Nasser/Fayizal)
Upgrade/downgrade procedure (done; check single-node upgrade/downgrade for v2.4.x)
Vendor support for Multus CNI (done; deprecated; pending switch 802.1q multi VLAN test)
IB SRIOV with static IP (done; deprecated; pending switch 802.1q multi VLAN test)
etcd recovery (done; delete node, re-register)
certificate rotation (done)
Pod security policy (done; assigned at the Project defn)
Project network isolation (done)
Cluster monitoring (done)
Local block PV for ZFS (done)</p>
</div></blockquote>
<p>Longhorn</p>
<blockquote>
<div><p>v1.1.0 (expected early Nov; node failure handling cleanup; rebuild from existing replica; data locality)
I/O performance (done)
Storage tags (done)
Disaster Recovery procedure (done)
PV snapshots and backups (done; nfs blocksize 2MB)
NFS user quota (done)
Pod’s terminationGracePeriodSeconds: 30</p>
</div></blockquote>
<dl>
<dt>Canal CNI</dt><dd><p>Pods security policy
Project network isolation (for IDM especially) (done)</p>
</dd>
<dt>Monitoring (prometheus/grafana)</dt><dd><dl class="simple">
<dt>Cluster monitoring</dt><dd><p>Node selector (done; label node first)</p>
</dd>
</dl>
<p>Project monitoring</p>
</dd>
<dt>Pod resource policy and quota</dt><dd><p>Ephemeral storage for each pod
Project quotas
Memory request/limit
Default request/limit for namespace/project</p>
</dd>
<dt>Lustre</dt><dd><p>v. lustre-2.12.0.5_cray_327_g809416f
CentOS 8.2 client (done)
Ubuntu 18.04.5 (done)</p>
</dd>
<dt>Beegfs</dt><dd><p>v7.2
Require metadata-storage downtime to upgrade datastructure
CentOS 8.2 client (done)
Ubuntu 18.04.5 (done)</p>
</dd>
<dt>UFM</dt><dd><p>v6.1.0
SRIOV (done)</p>
</dd>
<dt>Containers</dt><dd><p>Lustre hostPath mount in pod and volumeMount in container
Use limitrange, quota, PSP, securityContext
Pods:
Master (ubuntu20 base)</p>
<blockquote>
<div><p>MX
monitor (Ganglia/nagios) + monitor-db
Syslog
Salt
Docker registry backup</p>
</div></blockquote>
<dl class="simple">
<dt>Worker1 (ubuntu20 base)</dt><dd><p>syslog-elk
Repo + repo-centos
Slurm (centos8)
Warewulf + warewulf-ubuntu
IDM (centos8; ssh)
Docker registry (backup in master)</p>
</dd>
<dt>Worker2 (ubuntu20 base)</dt><dd><p>home (longhorn nfs)</p>
</dd>
<dt>Worker3 (ubuntu20 base)</dt><dd><p>apps (longhorn nfs)</p>
</dd>
<dt>Worker4/5 (ubuntu18 base)</dt><dd><p>mgmt3 (centos8; autofs /home; ssh; syslog-apps)
mgmt-backend
home-backup</p>
</dd>
</dl>
</dd>
<dt>Warewulf</dt><dd><p>v3.9-devel
PXE through IB (working on Mellanox ConnectX5, not working for current HP ConnectX4)</p>
<blockquote>
<div><p>FlexBoot firmware update for ConnectX4 (at least FlexBoot 3.5.403_4115)</p>
</div></blockquote>
<p>UEFI PXE booting (done)
Current CentOS 7.2 images support (done; need to copy current initrd.gz files)
CentOS 8.2 support</p>
</dd>
<dt>Repo</dt><dd><p>CentOS 8.2 repository (done)
Ubuntu 20.04 repository (done)
Ubuntu 18.04 repository (done)
CentOS 8.2 kickstart (done; replace quiet boot line in linuxefi with: inst.ks=”<a class="reference external" href="http://repo.hpc.abudhabi.nyu.edu/get-kickstart.php?profile=centos8">http://repo.hpc.abudhabi.nyu.edu/get-kickstart.php?profile=centos8</a>-static&amp;hostname=&lt;FQDN_HOSTNAME&gt;&amp;ip=&lt;IP&gt;” ip=&lt;IP&gt;::&lt;GATEWAY&gt;:&lt;NETMASK&gt;::&lt;KSDEVICE|ens1f0&gt;:none:&lt;DNS0&gt;:0.0.0.0 console=tty0 console=ttyS1,115200 selinux=0)</p>
<p>Ubuntu 20.04 Live Installer image (done)
Ubuntu 20.04 autoinstall (done; add after quiet boot line in linux with: autoinstall fsck.mode=skip hostname=&lt;HOSTNAME&gt; “ds=nocloud-net;s=http://repo.hpc.abudhabi.nyu.edu/public/kickstarts/ubuntu2004/” ip=&lt;IP&gt;::&lt;GATEWAY&gt;:&lt;NETMASK&gt;::&lt;KSDEVICE|ens1f0&gt;:none:&lt;DNS0&gt;:0.0.0.0)
Ubuntu 18.04 Alternate Installer image (done)
Ubuntu 18.04 preseed (done; replace file=… quiet with auto=true priority=critical selinux=0 url=”<a class="reference external" href="http://10.0.0.26/get-kickstart.php?profile=ubuntu1804">http://10.0.0.26/get-kickstart.php?profile=ubuntu1804</a>-static&amp;hostname=&lt;HOSTNAME&gt;&amp;ip=&lt;IP&gt;”; optionally to auto-config network: interface=&lt;KSDEVICE&gt; netcfg/disable_autoconfig=true netcfg/get_ipaddress=&lt;IP&gt; netcfg/get_netmask=&lt;NETMASK&gt; netcfg/get_gateway=&lt;GATEWAY&gt; netcfg/get_nameservers=&lt;DNS&gt; netcfg/confirm_static=true)
Metadata versioning fix for hpc repo (done)</p>
</dd>
<dt>Salt</dt><dd><p>v3001.1
CentOS 8.2 client
Ubuntu 20.04 client
Password management (done)
Merge secret repos (done)
Salt-SSH (done)
SaltGUI (done)
Node type inherit from warewulf (done; patched warewulf to add wwgroups to kernel args)
GPG (done)</p>
</dd>
<dt>Git</dt><dd><p>gitattributes for encryption (deprecated; use GPG)
pre-commit hook to check attribute content
post-receive hook (git diff-tree –no-commit-id –name-only -r &lt;SHA&gt;)</p>
</dd>
<dt>Slurm</dt><dd><p>v20.02.3
CentOS 8.2 client (done)
PMIx support (done)
slurmtop (done)
Remove legacy PBS support
Remove legacy BLCR support
Remove mpiexec support
Remove showq support (PBS command)
Remove OSU shmem pmi2 patch(question) (not available for slurm v20; Jorge requested this for current Slurm version)</p>
</dd>
<dt>License</dt><dd><dl class="simple">
<dt>Check if still needed otherwise apps team to create containers</dt><dd><p>Intel (to be removed)
DDT (to be removed)
IDL/Harris (to be removed)
Lumerical (to be removed)</p>
</dd>
</dl>
</dd>
<dt>Elasticsearch-Logstash-Grafana</dt><dd><p>ELK v7.6.2 (done)
Grafana v4.6.5 (done)</p>
</dd>
<dt>Ballast</dt><dd><p>v2.2
Daemon on Ubuntu 20.04 (done)
Client on CentOS 8.2 (done)</p>
</dd>
</dl>
</div>
<div class="section" id="k8s-nodes">
<h2>K8S nodes<a class="headerlink" href="#k8s-nodes" title="Permalink to this headline">¶</a></h2>
<dl>
<dt>GC cleanup (as per Rancher)</dt><dd><p>/var/lib/kubelet (emptyDir)
/var/log → /var/lib/docker/containers (<a class="reference external" href="https://success.docker.com/article/how-to-setup-log-rotation-post-installation">https://success.docker.com/article/how-to-setup-log-rotation-post-installation</a>)
/var/lib/docker</p>
<blockquote>
<div><p>image</p>
<p><strong>kubelet args</strong>
services:
kubelet:</p>
<blockquote>
<div><p>extra_args:
image-gc-high-threshold: 60</p>
</div></blockquote>
<p>volumes (manual cleanup)
overlay2 (sparse file: du -shc /var/lib/docker/overlay2/<a href="#id1"><span class="problematic" id="id2">*</span></a>/diff)</p>
</div></blockquote>
</dd>
</dl>
<p>Add master/worker-mgmt node labels
Enforce Allocatable on pods only (not kube-reserved nor system-reserved)
HA NFS-server routes  (deprecated; pending switch 802.1q multi VLAN test)</p>
<blockquote>
<div><p>Ubuntu: netplan should have critical keyword on ib0 (systemd &lt;=242 DHCP: CriticalConnection, &gt;=243 Network: KeepConfiguration)
RHEL: Disable NetworkManager</p>
</div></blockquote>
</div>
<div class="section" id="compute-node">
<h2>Compute node<a class="headerlink" href="#compute-node" title="Permalink to this headline">¶</a></h2>
<p>UEFI storage (done)
UEFI booting (done)
BIOS: Enable C-states, disable C2 through OS (cpupower idle-set -d 2)
Disable TurboBoost</p>
<blockquote>
<div><p>intel_pstate: echo 1 &gt; /sys/devices/system/cpu/intel_pstate/no_turbo
acpi-cpufreq: echo 0 &gt; /sys/devices/system/cpu/cpufreq/boost</p>
</div></blockquote>
<p>Disable HT (cat /sys/devices/system/cpu/cpu*/topology/thread_siblings_list | awk -F, ‘{print $2}’ | sort -n | uniq | ( while read X ; do echo $X ; echo 0 &gt; /sys/devices/system/cpu/cpu$X/online ; done ))
Governor: intel_pstate=passive (Intel), acpi-cpufreq (AMD): schedutil/ondemand
traffic-control for /home write (throttled to 15kbps) (done)
HA default route</p>
<blockquote>
<div><p>keepalived v2.1.0
login nodes (done)
nsca check_procs (done)</p>
</div></blockquote>
<p>Rebuild Ganglia (done)</p>
</div>
<div class="section" id="viz-node">
<h2>Viz node<a class="headerlink" href="#viz-node" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>NVidia</dt><dd><p>v440.82 (done)</p>
</dd>
</dl>
<p>VirtualGL (done)
TurboVNC (done)
LDAP (done)</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Center for Research Computing | NYU Abu Dhabi.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>