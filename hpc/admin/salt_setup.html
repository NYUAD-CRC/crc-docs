

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Salt Setup &mdash; CRC Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/crc-wordmark-light.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">RCS Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rcs/index.html">Research Computing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rcs/kb/index.html">Knowledge Base</a></li>
</ul>
<p class="caption"><span class="caption-text">HPC Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">High Performance Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounts/index.html">Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/index.html">System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/index.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/index.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jobs/index.html">Jobs Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../research/index.html">Research Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/index.html">Help</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CRC Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Salt Setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/hpc/admin/salt_setup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="salt-setup">
<h1>Salt Setup<a class="headerlink" href="#salt-setup" title="Permalink to this headline">¶</a></h1>
<p>salt:// Source Location
Salt source locations and priorities are listed in Salt’s masters /etc/salt/master.d/local.conf. In general, locations are structured as follow (in no priority ordering):</p>
<dl class="simple">
<dt>Git-based locations for text files (the master branch is the production branch):</dt><dd><p>salt-state
salt-state-secret (these are the stuff which shouldn’t go to github, like ssh keys, etc.)
salt-pillar
salt-pillar-secret (mostly user passwords and uid/gid)</p>
</dd>
<dt>Filesystem-based locations for binaries, etc.:</dt><dd><p>/srv/salt/production/state (production files)
/srv/salt/development (development files which need access to production files)</p>
</dd>
</dl>
<p>Notes:</p>
<blockquote>
<div><p>/srv/salt/development is used to test features which require the use of production’s state SLS files. Note that even if this is called development folder, anything used here might affect production nodes if a node Salt’s id matches. Therefore, any independent testing should be done in your own separate Salt master/client installation.
git cli on Salt’s master is aliased. git command (for user purposes) should not be run on Salt’s masters because it can mess up the permission of files (and therefore the sync from clients) on the git repositories. Use git from your own laptop/desktop.</p>
</div></blockquote>
<div class="section" id="pillar-file-folder-structure">
<h2>Pillar file/folder structure<a class="headerlink" href="#pillar-file-folder-structure" title="Permalink to this headline">¶</a></h2>
<p>Actual pillar inheritance structure is given in the top.sls file. In general, pillar state SLS are named based on domain/node-group/node names; individual node files are placed inside nodes folder. So we have something like this:</p>
<dl>
<dt>nyuad</dt><dd><dl>
<dt>dalma</dt><dd><dl class="simple">
<dt>dalma-mgmt</dt><dd><p>nodes/mgmt1
nodes/mgmt2</p>
</dd>
</dl>
<p>dalma-mx
nodes/mx1
nodes/mx2</p>
</dd>
</dl>
<p>nodes/mgmt3
nodes/syslog
…
hadoop</p>
<blockquote>
<div><p>nodes/aduae183-lap
…</p>
</div></blockquote>
</dd>
</dl>
<p>salt-pillar-secret are mostly user/password files, so they only have flat directory structure. Any child pillar with the same name can replace the parent pillar with the same name. Pillar is also additive.</p>
<p>State file/folder structure
State folder SLS files are structured as follow:</p>
<p>Service SLS files
Config SLS files
Config folders which contain configs for more complex setup:</p>
<blockquote>
<div><p>slurm
beegfs</p>
</div></blockquote>
<dl class="simple">
<dt>build folder</dt><dd><p>package SLS files</p>
</dd>
<dt>files folder (non-SLS files)</dt><dd><p>folders corresponding to service SLS files
folders corresponding to config SLS files
folders corresponding to cluster folders</p>
</dd>
</dl>
<p>scripts folder
Cluster folders, such as:
hadoop
dalma</p>
<blockquote>
<div><p>node SLS files
units folder (common service/config SLS files which can be called by node files)</p>
</div></blockquote>
</div>
<div class="section" id="high-availability">
<h2>High availability<a class="headerlink" href="#high-availability" title="Permalink to this headline">¶</a></h2>
<p>Salt masters are running in active-active mode with salt1 the primary. Salt files in the filesystem /srv/salt are synced using lsync. Salt files in the git repositories are not synced, you need to manually have push to both servers salt1 and salt2 during git push.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Center for Research Computing | NYU Abu Dhabi.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>