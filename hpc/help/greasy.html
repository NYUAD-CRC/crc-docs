

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>“Greasy” Workload Management Tool &mdash; CRC Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/crc-wordmark-light.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">HPC Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hpc.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../old_hpc.html">Previous HPC Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounts/index.html">Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/index.html">System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/index.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/index.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jobs/index.html">Jobs Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ood/index.html">HPC Web Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../research/index.html">Research Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/index.html">HPC Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc_load/index.html">HPC Load</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RCS Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rcs/rcs.html">Research Computing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rcs/1001n.html">1001n Research Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rcs/kb/index.html">Knowledge Base</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data_science/data_science.html">Research Data Science Services</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Team</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../team.html">Center for Research Computing Team</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CRC Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>“Greasy” Workload Management Tool</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="greasy-workload-management-tool">
<h1>“Greasy” Workload Management Tool<a class="headerlink" href="#greasy-workload-management-tool" title="Permalink to this heading">¶</a></h1>
<p>We want to introduce you the “greasy” tool. This tool will easy to implement “High Throughput Computing” (HTC) jobs on Jubail. HTC jobs  are usually concerned about resource availability and resilience normally for long running tasks. In most cases HPC environments are not suitable to run HTC workload and this is where Greasy can become a handy tool to use. It will help users to manage workflows with many serial tasks even if they have dependencies among them in an easy and robust way.</p>
<p>This is a tools which is still under development, so some improvements may come up in the future.</p>
<p>You can start by copying the example directory that you will find in the installation dir:
/share/apps/NYUAD/greasy/openmpi_1.10.2/2.1/example/</p>
<p>Step-by-step guide
The first thing to notice is that there are two  files:</p>
<p>1.- the file with the tasks to do ( example.txt )</p>
<p>example.txt is the text file that contains the list of tasks to do.
There is a direct correspondence between the line number and the task index, so the line 11th in the file will correspond to the task with index 11.
The dependencies are expressed in the format [#  #] at the beginning of the line.
For more details about how to write dependencies please go to the user’s guide</p>
<p>example.txt Collapse source
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
/bin/sleep 1
/usr/bin/hostname
/bin/sleep 3
/bin/sleep 4
/bin/sleep 5
/bin/sleep 6</p>
<div class="section" id="these-lines-with-dependencies-are-correct">
<h2># These Lines with dependencies are correct<a class="headerlink" href="#these-lines-with-dependencies-are-correct" title="Permalink to this heading">¶</a></h2>
<p>[# 5 #]         /bin/sleep 11
[# -1#]         /bin/sleep 12
[#1-3#]         /bin/sleep 13</p>
</div>
<div class="section" id="these-ones-are-not-ok">
<h2># these ones are not Ok<a class="headerlink" href="#these-ones-are-not-ok" title="Permalink to this heading">¶</a></h2>
<p># sharps missing
[ 1 ]           /bin/sleep 22
[#1 ]           /bin/sleep 23
[ 1 #]          /bin/sleep 24
# Forward dependencies are not allowed
[# +1 #]        /bin/sleep 26
[# 1000 #]      /bin/sleep 27
# Dependencies must point to a task
[# -1 #]        /bin/sleep 29
# Dependencies must be numerical, and ranges must be expressed correctly
[# 2-&gt;6 #]      /bin/sleep 31
[# mistake #]   /bin/sleep 32
2.- the submission script ( Jubail_greasy.job )</p>
<p>The file  Jubail_greasy.job is the file you submit to queues
Greasy has different types of “engines” for different kinds of underlying hardware. In a cluster environment like Butinah you can use “mpi” engine by setting the environment variable in the submission script :</p>
<p>export GREASY_ENGINE=mpi
but this is the default engine so you don’t have to put it in the script.</p>
<p>If you plan to use only one node for your tasks then you might like to set the engine to “thread”. The following line would be fine if you run it on the superfat node which has 32 cores. Note that the number of workers are set to 32-1 since 1 is used for scheduling.</p>
<p>export GREASY_ENGINE=thread
export GREASY_NWORKERS=31</p>
<p>Please refer to the Greasy User’s Guide for more config details</p>
<p>Jubail_greasy.job Expand source</p>
<p>3.- Running Greasy  is simple:</p>
<p>prepare your tasks file
load the module</p>
<p>$&gt; module load greasy
$&gt; module load openmpi
submit the job</p>
<p>$&gt; sbatch Jubail_greasy.job</p>
<p>4.- Getting the results  is also very simple:</p>
<p>Check the log file ( GREASY_LOGFILE ) for progress. In this file you can also check the resources utilization so you can tune your runs to make a more efficient use of the cluster.
To see different colors for different kind of messages, use the tool “greasycolorlog”
$&gt; cat greasy.log | greasycolorlog Collapse source
$&gt; cat greasy.log | greasycolorlog</p>
<p>[2014-01-30 11:12:35] Start greasing /scratch/jonarbo/apps/runs/greasy/example/example.txt
[2014-01-30 11:12:35] WARNING: Task 23 does not seem to be correct. Skipping…
[2014-01-30 11:12:35] WARNING: Task 26 does not seem to be correct. Skipping…
[2014-01-30 11:12:35] WARNING: Task 31 does not seem to be correct. Skipping…
[2014-01-30 11:12:35] WARNING: Task 32 does not seem to be correct. Skipping…
[2014-01-30 11:12:35] WARNING: Dependency 1000 of task 27 is not valid.
[2014-01-30 11:12:35] WARNING: Dependency 28 of task 29 is not valid.
[2014-01-30 11:12:35] WARNING: Invalid tasks found. Greasy will ignore them
[2014-01-30 11:12:35] INFO: MPI engine is ready to run with 23 workers
[2014-01-30 11:12:35] INFO: Allocating task 1
[2014-01-30 11:12:35] INFO: Allocating task 2
[2014-01-30 11:12:35] INFO: Allocating task 3
[2014-01-30 11:12:35] INFO: Allocating task 4
[2014-01-30 11:12:35] INFO: Allocating task 5
[2014-01-30 11:12:35] INFO: Allocating task 6
[2014-01-30 11:12:35] INFO: Allocating task 15
[2014-01-30 11:12:35] INFO: Allocating task 22
[2014-01-30 11:12:35] INFO: Allocating task 24
[2014-01-30 11:12:35] ERROR: Task 15 failed with exit code 32512 on node compute-6-26.local. Elapsed: 00:00:00
[2014-01-30 11:12:35] ERROR: Task 24 failed with exit code 512 on node compute-6-26.local. Elapsed: 00:00:00
[2014-01-30 11:12:35] ERROR: Task 2 failed with exit code 32512 on node compute-6-26.local. Elapsed: 00:00:00
[2014-01-30 11:12:35] WARNING: Cancelling task 13 because of task 2 failure
[2014-01-30 11:12:35] ERROR: Task 22 failed with exit code 512 on node compute-6-26.local. Elapsed: 00:00:00
[2014-01-30 11:12:36] INFO: Task 1 completed successfully on node compute-6-26.local. Elapsed: 00:00:01
[2014-01-30 11:12:38] INFO: Task 3 completed successfully on node compute-6-26.local. Elapsed: 00:00:03
[2014-01-30 11:12:39] INFO: Task 4 completed successfully on node compute-6-26.local. Elapsed: 00:00:04
[2014-01-30 11:12:40] INFO: Task 5 completed successfully on node compute-6-26.local. Elapsed: 00:00:05
[2014-01-30 11:12:40] INFO: Allocating task 11
[2014-01-30 11:12:40] INFO: Allocating task 14
[2014-01-30 11:12:41] INFO: Task 6 completed successfully on node compute-6-26.local. Elapsed: 00:00:06
[2014-01-30 11:12:51] INFO: Task 11 completed successfully on node compute-6-26.local. Elapsed: 00:00:11
[2014-01-30 11:12:51] INFO: Allocating task 12
[2014-01-30 11:12:54] INFO: Task 14 completed successfully on node compute-6-26.local. Elapsed: 00:00:14
[2014-01-30 11:13:03] INFO: Task 12 completed successfully on node compute-6-28.local. Elapsed: 00:00:12
[2014-01-30 11:13:03] INFO: MPI engine finished
[2014-01-30 11:13:03] INFO: Summary of 19 tasks: 8 OK, 4 FAILED, 1 CANCELLED, 6 INVALID.
[2014-01-30 11:13:03] INFO: Total time: 00:00:28
[2014-01-30 11:13:03] INFO: Resource Utilization: 8.69%
[2014-01-30 11:13:03] INFO: Creating restart file /scratch/jonarbo/apps/runs/greasy/example/example.txt.rst…
[2014-01-30 11:13:03] INFO: Restart file created
[2014-01-30 11:13:03] Finished greasing /scratch/jonarbo/apps/runs/greasy/example/example.txt</p>
<p>5.- Restarting the job</p>
<p>Restarting a job can be done easily because Greasy will create a restart file with the that were not completed and it will include some clues about what went wrong so the user can fix it and use the restart file for the next submission.</p>
<p>example.txt.rst Collapse source
#
# Greasy restart file generated at 2014-01-30 11:13:03
# Original task file: /scratch/jonarbo/apps/runs/greasy/example///scratch/jonarbo/apps/runs/greasy/example/example.txt
# Log file: /scratch/jonarbo/apps/runs/greasy/example/greasy.log
#</p>
<p># Warning: Task 2 failed
/usr/bin/hostname
# Warning: Task 13 was cancelled due to a dependency failure
[# 8 #] /bin/sleep 13
# Warning: Task 15 failed
/usr/bin/hostname
# Warning: Task 22 failed
[ 1 ] /bin/sleep 22
# Warning: Task 24 failed
[ 1 #] /bin/sleep 24</p>
<p># Invalid tasks were found. Check these lines on /scratch/jonarbo/apps/runs/greasy/example/example.txt:
# 23, 26, 27, 29, 31, 32</p>
<p># End of restart file</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2023, Center for Research Computing | NYU Abu Dhabi.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>